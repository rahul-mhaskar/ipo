// src/components/Footer.js
import React, { useState, useEffect, useRef } from 'react';

const Footer = () => {
  const [isFooterExpanded, setIsFooterExpanded] = useState(true);
  const footerTimeoutRef = useRef(null);
  const bounceIntervalRef = useRef(null);

  useEffect(() => {
    const startCollapseTimeout = () => {
      if (footerTimeoutRef.current) clearTimeout(footerTimeoutRef.current);
      footerTimeoutRef.current = setTimeout(() => setIsFooterExpanded(false), 3000);
    };

    const startBounceAnimation = () => {
      if (bounceIntervalRef.current) clearInterval(bounceIntervalRef.current);
      bounceIntervalRef.current = setInterval(() => {
        const footerElement = document.getElementById('broker-section');
        if (footerElement) {
          footerElement.classList.add('animate-bounce-once');
          setTimeout(() => footerElement.classList.remove('animate-bounce-once'), 500);
        }
      }, 10000);
    };

    if (isFooterExpanded) {
      startCollapseTimeout();
      if (bounceIntervalRef.current) clearInterval(bounceIntervalRef.current);
    } else {
      startBounceAnimation();
    }

    return () => {
      if (footerTimeoutRef.current) clearTimeout(footerTimeoutRef.current);
      if (bounceIntervalRef.current) clearInterval(bounceIntervalRef.current);
    };
  }, [isFooterExpanded]);

  const renderBrokerLinks = () => {
    const brokers = [
      { name: "Zerodha", href: "https://zerodha.com/open-account?c=VCB643", logo: "https://zerodha.com/static/images/logo.svg" },
      { name: "Upstox", href: "https://upstox.onelink.me/0H1s/4LAYGW", logo: "https://assets.upstox.com/website/images/upstox-new-logo.svg" },
      { name: "Paytm Money", href: "https://paytmmoney.page.link/DSwSvdhoasovQYLz9", logo: "https://play-lh.googleusercontent.com/nXCY9Did341stoQEhCEH5wJW2FBybZYbpiYl2J-eCajYOXZ_XXXHX1ptjATuA0zayg" },
    ];
    return brokers.map((broker, idx) => (
      <a key={idx} href={broker.href} target="_blank" rel="noopener noreferrer" className="flex flex-col items-center w-20 sm:w-24 text-center hover:scale-105 hover:shadow-lg transition-all p-1 sm:p-2 bg-gray-50 rounded-lg">
        <img src={broker.logo} alt={broker.name} className="h-6 sm:h-8 mb-0.5 object-contain" />
        <span className="text-xs text-gray-600">{broker.name}</span>
      </a>
    ));
  };

  return (
    <footer
      id="broker-section"
      className={`fixed bottom-0 left-0 w-full bg-white border-t shadow z-40 transition-all duration-[2000ms] ease-in-out
        ${isFooterExpanded ? 'h-auto py-2 sm:py-2 px-2 sm:px-4' : 'h-[40px] sm:h-[40px] py-1 px-2 sm:px-4 overflow-hidden'}`}
      onClick={() => setIsFooterExpanded(!isFooterExpanded)}
    >
      <div className="flex justify-center items-center h-full sm:h-auto cursor-pointer">
        <div className="flex flex-col items-center">
          <svg className={`w-5 h-5 text-gray-600 transform transition-transform duration-300 ${isFooterExpanded ? 'rotate-180' : 'rotate-0'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path>
          </svg>
          <p className="text-gray-500 text-xs mt-0.5 sm:hidden">{isFooterExpanded ? 'Tap to Collapse' : 'Tap for Brokers'}</p>
        </div>
      </div>
      <div className={`transition-opacity duration-300 ${isFooterExpanded ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>
        <div className="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-center sm:justify-between gap-1 sm:gap-2">
          <div className="whatsapp-section text-center sm:text-left mb-0.5 sm:mb-1">
            <a href="https://www.whatsapp.com/channel/0029VbBPCHaKAwEkO9zdRl34" target="_blank" rel="noopener noreferrer" className="inline-flex items-center bg-green-600 text-white px-3 py-1 rounded-full shadow-md hover:bg-green-700 hover:scale-105 transition transform text-xs">
              <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" className="w-3.5 h-3.5 mr-1" />
              WhatsApp Updates
            </a>
          </div>
          <div className="flex flex-col items-center sm:items-end">
            <h2 className="text-xs sm:text-sm font-semibold mb-0.5 sm:mb-1 text-center text-gray-800 hover:text-blue-600 transition-all">
              üõ°Ô∏è Open Demat account securely with verified investment brokers.
            </h2>
            <div className="flex flex-wrap justify-center gap-1 overflow-x-auto pb-0.5">
              {renderBrokerLinks()}
            </div>
          </div>
        </div>
        <p className="text-center text-gray-500 text-xs mt-1">¬© {new Date().getFullYear()} Track My IPO. All rights reserved.</p>
      </div>
    </footer>
  );
};

export default Footer;
